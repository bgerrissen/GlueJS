/** @author Ben Gerrissen
 *  @license MIT, GPL
 *  @version 0.2 ( 1 - 11 - 2010 )
 */
(function(s,t){var H=+new Date,I=Array.prototype.slice,J=Object.prototype.toString,k=function(a){return J.call(a).replace(/\[object\s|\]/g,"").toLowerCase()},l=function(){var a=I.call(arguments),d=false,c=a[0],b=a[1],e=a[2],f;if(k(a[0])==="boolean"){d=a[0];c=a[1];b=a[2];e=a[3]}for(f in b)if(b.hasOwnProperty(f))if(d&&k(b[f])==="object"){if(k(c[f])!=="object")c[f]={};l(d,c[f],b[f])}else if(e||!c[f])c[f]=b[f];return c},m={},p=function(a,d){m[a]||(m[a]=[]);m[a].push(d)},A=function(a,d){var c=m[a],b;if(c)for(b=
c.length;b&&b--;)if(c[b]===d){c.splice(b,1);b--}},i=function(a,d){var c,b=m[a],e,f,g;if(b&&b.length){b=[].concat(b);c=l(true,{type:a,deafen:function(){A(a,c.currentListener)}},d,false);e=0;for(f=b.length;e<f;e++){g=b[e];c.currentListener=g;try{if(typeof g==="function")g(c);else g.handleEvent&&g.handleEvent(c)}catch(n){i("glue:error",{message:n})}}}},j={},B=function(){var a=k(arguments[0]);if(arguments.length===1&&a==="object")l(j,arguments[0],true);else if(a==="string")j[arguments[0]]=arguments[1]},
K=/([^\s]*)(?:\s?\(([^\)]+)\))?/,q=function(a){if(k(a)!=="string")return a;a=a.match(K);var d={};if(a[1])d.path=a[1];if(a[2])d.lookup=a[2].replace(/\s/g,"").split(",");return d},u={},o={},C=function(a,d){var c=k(a),b;if(c==="string"){a=RegExp("^"+a);o[d]=a}else if(c==="object")for(b in a)C(b,a[b])},v={},w=[],D=function(a){a=q(a);if(!a.path)return null;if(v[a.path])return v[a.path];var d=a.path,c=l,b;a:{b=a.path;var e=j.debug?"?"+ ++H:"",f;for(f in o)if(o.hasOwnProperty(f)&&o[f].test(b)){b=b.replace(o[f],
f)+".js"+e;break a}b=j.defaultContext+b+".js"+e}return v[d]=c({status:0,needs:[],fetch:[],exports:[],source:b,data:a},a)},x=function(a){for(var d=[],c=a.length;c&&c--;)a[c].status!==3&&d.push(a[c]);return d},E=function(a){if(a){if(a.needs.length)a.imports=y(a.needs);if(a.callback)try{a.exports.push(a.callback.apply(null,a.imports))}catch(d){i("glue:error",{message:d})}a.status=3;delete a.data;delete a.needs;delete a.fetch;delete a.source;delete a.imports;delete a.node;delete a.callback;i("glue:complete",
{path:a.path,exports:a.exports})}},y=function(a){for(var d=a.length,c=[];d&&d--;)c=[].concat(c,a[d].exports);return c},r=t.getElementsByTagName("script"),L=t.createElement("script"),z=r[r.length-1];r=z.src.replace(/[^\\\/]*\.js[^\\\/]?$/,"");var F=function(a){a&&a.length&&z.parentNode.insertBefore(M(a,t.createDocumentFragment()),z)},M=function(a,d){for(var c=a.length,b;c&&c--;){b=a[c];b.status===0&&N(b,d);b.status=1}return d},O=function(a){a.timeoutID=setTimeout(function(){a.status=-1;i("glue:error",
{message:"LoadError: Failed to load resource '"+a.path+"' at '"+a.source+"'"})},j.scriptTimeout)},N=function(a,d){var c=a.node=L.cloneNode(false);c.src=a.source;d.appendChild(c);c.onreadystatechange=c.onload=function(){var b=a.node;if(!b.readyState||/complete|loaded/i.test(b.readyState)){j.debug||b.parentNode.removeChild(b);a.node=b.onreadystatechange=b.onload=null;i("glue:loaded",a.data);clearTimeout(a.timeoutID)}};c=null;O(a);i("glue:loading",a.data)},G=function(a){for(var d={},c=[],b=a.length,
e,f;b&&b--;){e=a[b];f=k(e);if(f==="string")c.push(e);else if(f==="array")c=c.concat(e);else if(f==="function")d.callback=e}a=c;for(b=a.length;b&&b--;){a:{e=a[b];f={};for(var g=q(e).path,n=e;u[g];){if(f[g]){i("glue:error",{message:"CircularReferenceError: forced path '"+e+"' lead to a cirular reference, operation cancelled."});e=e;break a}n=u[g];g=q(n).path;f[g]=true}e=n}e=q(e);if(e.path)a[b]=D(e);else a.splice(b,1)}d.needs=a;d.fetch=x(c);return d},h=function(){var a=G(arguments);w.push(a);a.fetch&&
F(a.fetch)};p("glue:loaded",function(a){var d=D(a.path),c=w.pop(),b;if(d){if(c)l(d,c,true);else if(a.lookup)for(c=a.lookup.length;c&&c--;){b=a.lookup[c];d.exports[c]=s[b];j.cleanGlobal&&delete s[b]}if(d.fetch.length){d.status=2;p("glue:complete",function(e){d.fetch=x(d.fetch);if(!d.fetch.length&&d.status!==3){e.deafen();E(d)}})}else E(d);w=[]}});B({defaultContext:r,cleanGlobal:true,debug:false,scriptTimeout:5E3});h.map=C;h.set=B;h.get=function(a){return j[a]};h.use=function(){var a=G(arguments);if(a.fetch.length){p("glue:complete",
function(d){a.fetch=x(a.fetch);if(!a.fetch.length){d.deafen();a.callback.apply(null,y(a.needs))}});F(a.fetch)}else a.callback.apply(null,y(a.needs))};h.force=function(a,d){u[a]=d};h.listen=p;h.deafen=A;h.notify=i;s.glue=h})(window,document);